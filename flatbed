#! /bin/bash
	#What is this program?
	# This program is designed to act as a GUI for flatpak.
	#A combination of yad and zenity is used to generate graphical window elements and notifications.
	helper="Flatback"
	versnum="0.8"
	FPV=$(flatpak --version)
	FPA=$(flatpak --default-arch)
	header="$helper $versnum - Using flatpak $FPV $FPA"
	logo="flathub-icon.svg"
	./config

	./fpappinfo

	#ADD SECURITY ICON and switch to yad
			zenity --question \
			--height=150 --width=500 \
			--title="$header - Administrator authorisation" \
			--text="$helper should only be used by individuals authorised to install, uninstall and modify software on this device. Would you like to proceed?"
			if [ $? -eq "1" ]; then
			exit
			elif [ $? -eq "0" ]; then
			#Create the file bellow AND add it to the installer
			bash ~/.config/flatback/config
			zenity --notification --text="$header"
			sleep 1s
			fi
	# Fix MASK


	#Completed - $run, $update, history, install
	flatback="0"
	until [ $flatback -eq "1" ]; do
	#main menu loop opened
			#flatback is a variable generated by selecting a function from a gui menu, menu functions are denoted with -- (as per yad)
			main=$(yad --list --radiolist \
			--title="$header - Main Menu" \
			--text="Select a flatpak option" \
			--image=$logo \
			--fullscreen \
			--width=700 --height=375 \
			--center \
			--button="Proceed":0 \
			--column="Selected" --column="Function"  --column="Description" \
			""  "install"                "Install an application or runtime" \
			""  "run"		     "run an application or runtime" \
			""  "update"                 "Update an installed application or runtime" \
			"" "uninstall"              "Uninstall an installed application or runtime" \
			"" "kill"		    "Stop a running application" \
			""  "mask"                   "Mask out updates and automatic installation" \
			""  "pin"                    "Pin a runtime to prevent automatic removal" \
			""  "list"                  "List installed apps and/or runtimes" \
			""  "info"                   "Show info for installed app or runtime" \
			""  "history"                "Show history" \
			""  "config"                 "Configure flatpak" \
			""  "repair"                 "Repair flatpak installation" \
			""  "create-usb"             "Put applications or runtimes onto removable media" \
			""  "exit"	     "Close the FLATBACK application" \
			""  "test" 		"test the latest search feature")

				selection=$(echo $main | cut -f 2 -d "|")
				execute="fp$selection"

				bash $execute
				exit_status=$(echo $main | cut -f 2 -d "|" | grep -c "exit")

				echo "User selected $selection" | lolcat
				if [ $exit_status -ne "0" ]; then
				main="1"
				exit
				fi
	done
